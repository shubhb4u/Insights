<template>
    <div class="q-feature-products">
        <div class="q-container">
            <h2>Featured Products</h2>
            <div class="slider-container q-product-slider-v1 q-product-boxes">
                <div class="splide" id="splide01">
                    <div class="splide__track" id="splide01-track">
                        <div class="splide__list" id="splide01-list">
                            <template for:each={displayedProducts} for:item="product">
                                <div class="product-block" key={product.Id}>
                                    <div class="img-ctr">
                                        <c-slds-carousel-cms-panel content-key={product.Product2.Content_Type__c}></c-slds-carousel-cms-panel>
                                    </div>
                                    <div class="pricingDetails">
                                        <div class="product-name slds-m-bottom_xx-small">
                                            <a data-id={product.Product2Id} data-name={product.Product2.Name} onclick={handleNavigate}>{product.Product2.Name}</a>
                                        </div>
                                        <div class="product-model slds-m-bottom_small">Product Code: <span>{product.Product2.ProductCode}</span></div>
                                        <div class="product-border slds-border_bottom slds-m-bottom_small"></div>
                                        <div class="pricesAndDiscounts">
                                            <div class="actualPrice">
                                                <div class="product-price-mobile"><span style="font-size: 1rem;">$</span>{product.formattedUnitPrice}</div>
                                            </div>
                                            <div class="disPrice">
                                                <template lwc:if={product.Product2.isDiscounted__c}>
                                                    <div class="product-discount">
                                                        <span class="discountVal">{product.Product2.AdjustmentPercent__c}%</span> OFF
                                                    </div>
                                                </template>
                                                <template lwc:elseif={product.Product2.isDiscountedAmount__c}>
                                                    <div class="product-discount"> 
                                                        <span class="discountVal">${product.Product2.Adjustment_Amount__c}</span> OFF
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                        <div class="msrpPrice">
                                            <template lwc:if={product.isDiscounted}>
                                                <div><span class="msrp">MSRP: ${product.UnitPrice}</span></div>
                                            </template>
                                            <template lwc:else>
                                                <div><span class="msrp"></span></div>
                                            </template>
                                        </div>
                                        <div class="quantitySelector">
                                            <c-quantity-selector-insights product-id={product.Product2.Id} onquantitychange={handleQuantityChange}></c-quantity-selector-insights>
    
                                        </div>
                                    </div>
                                    <a class="buyAnchor" data-id={product.Product2Id} data-name={product.Product2.Name} onclick={handleBuy}>Buy</a>
                                </div>
                            </template>
                        </div>
                    </div>
                    <div class="splide__arrows icomoon-container">
                        <button class="splide__arrow splide__arrow--prev sn-prev icomoon-icon icon-arrow_back" aria-label="Previous slide" onclick={handlePrevious}>Previous</button>
                        <ul class="splide__pagination">
                            <template for:each={carouselIndicators} for:item="indicator">
                                <li key={indicator.index}>
                                    <button class={indicator.class} type="button" data-index={indicator.index} aria-controls="splide01-slide" onclick={handleIndicatorClick}></button>
                                </li>
                            </template>
                        </ul>
                        <button class="splide__arrow splide__arrow--next sn-next icomoon-icon icon-arrow_forward" aria-label="Next slide" onclick={handleNext}>Next</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>